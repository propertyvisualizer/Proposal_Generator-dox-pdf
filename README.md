# Proposal Generator - DOCX/PDF

A web-based proposal generator application for creating professional business proposals with dynamic content and DOCX export functionality.

## Features

- üìù Interactive proposal form with service selection
- üé® Real-time preview with editable fields
- üìÑ DOCX document generation
- üñºÔ∏è Image upload and embedding
- üí∞ Dynamic pricing with tiered options
- üîÑ Auto-save functionality
- üìä Supabase integration for data persistence

## Configuration

### Environment Variables

The application uses environment variables for configuration. Copy `.env.example` to `.env` and configure:

```bash
cp .env.example .env
```

#### Available Environment Variables:

| Variable | Description | Default |
|----------|-------------|---------|
| `PORT` | Server port number | `3000` |
| `NODE_ENV` | Environment mode (development/production) | `development` |
| `SUPABASE_URL` | Supabase project URL | - |
| `SUPABASE_ANON_KEY` | Supabase anonymous key | - |
| `SUPABASE_SERVICE_KEY` | Supabase service role key | - |

### Dynamic Port Configuration

The application is designed to work with any port specified in the `.env` file:

1. **Server-side**: The Express server reads `PORT` from `.env`
2. **Client-side**: HTML files load `/config.js` which is dynamically generated by the server with the correct API URL

**Example:**
```env
# .env
PORT=8080
```

The server will:
- Run on `http://localhost:8080`
- Automatically configure client-side API calls to use `http://localhost:8080`

No hardcoded URLs! üéâ

## Installation

1. **Install dependencies:**
```bash
npm install
```

2. **Configure environment:**
```bash
cp .env.example .env
# Edit .env with your configuration
```

3. **Start the server:**
```bash
npm start
# or
node proposal-server.js
```

4. **Access the application:**
```
http://localhost:3000
```
(or whatever port you configured in `.env`)

## Usage

### Creating a Proposal

1. Open the application in your browser
2. Fill in client information
3. Select services and customize descriptions
4. Add perspective images (optional)
5. Review pricing summary
6. Click "Preview" to see the formatted proposal
7. Generate DOCX from the preview page

### API Endpoints

#### `GET /config.js`
Returns dynamic configuration for client-side code
- **Response**: JavaScript file with `window.APP_CONFIG` object

#### `POST /api/generate-proposal`
Generates a DOCX proposal document
- **Content-Type**: `multipart/form-data`
- **Body**:
  - `data`: JSON string with proposal data
  - `files`: Image files (optional)

## Architecture

### File Structure

```
‚îú‚îÄ‚îÄ .env                    # Environment configuration
‚îú‚îÄ‚îÄ .env.example           # Environment template
‚îú‚îÄ‚îÄ config.js              # Static config template (not used directly)
‚îú‚îÄ‚îÄ proposal-server.js     # Express server with dynamic config
‚îú‚îÄ‚îÄ proposal-form.html     # Main form interface
‚îú‚îÄ‚îÄ preview.html           # Proposal preview with editing
‚îú‚îÄ‚îÄ pure-docx-generator.js # DOCX generation logic
‚îú‚îÄ‚îÄ service_description.js # Service catalog definitions
‚îú‚îÄ‚îÄ database-schema.sql    # Database schema for persistence
‚îî‚îÄ‚îÄ supabase.ts           # Supabase TypeScript types

```

### Dynamic Configuration Flow

```
1. Browser requests /config.js
2. Server generates JavaScript with current PORT
3. Browser loads APP_CONFIG with correct API_URL
4. All API calls use APP_CONFIG.API_URL (no hardcoded URLs)
```

## Development

### Running in Development Mode

```bash
PORT=3000 NODE_ENV=development node proposal-server.js
```

### Running on Different Ports

Simply change the `PORT` in `.env`:

```env
PORT=8080
```

Restart the server - everything will work automatically!

### Testing Different Configurations

```bash
# Test on port 5000
PORT=5000 node proposal-server.js

# Test on port 8080
PORT=8080 node proposal-server.js
```

The client-side code will automatically connect to the correct port.

## Database Integration

The application supports Supabase for data persistence. Configure your Supabase credentials in `.env` and use the provided schema in `database-schema.sql`.

### Setting up Database

1. Create a Supabase project
2. Run `database-schema.sql` in the SQL editor
3. Add your Supabase credentials to `.env`

## Deployment

### Production Deployment

1. Set environment variables on your hosting platform:
```env
PORT=3000
NODE_ENV=production
SUPABASE_URL=your_production_url
SUPABASE_ANON_KEY=your_production_key
```

2. The application will automatically use these values - no code changes needed!

### Supported Platforms

- ‚úÖ Heroku (reads PORT automatically)
- ‚úÖ Railway
- ‚úÖ Render
- ‚úÖ Digital Ocean
- ‚úÖ AWS/GCP/Azure (with proper PORT configuration)

## Troubleshooting

### Client can't connect to server

**Issue**: Browser shows "Failed to fetch" errors

**Solution**: 
1. Check that the server is running
2. Verify `.env` has correct `PORT` value
3. Clear browser cache and reload
4. Check browser console for `APP_CONFIG` - it should show correct API_URL

### Port already in use

**Issue**: `Error: listen EADDRINUSE: address already in use :::3000`

**Solution**: Change `PORT` in `.env` to an available port:
```env
PORT=8080
```

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test with different PORT configurations
5. Submit a pull request

## License

[Your License Here]

## Support

For issues and questions, please open an issue on GitHub.
